-- COPY REFERENCE STUFF USED BY AN EXPERIMENT FOR EXPORT

-- V4_ALIB_COMPONENT
DROP TABLE IF EXISTS tempcopy.V4_ALIB_COMPONENT;

CREATE TABLE tempcopy.V4_ALIB_COMPONENT AS
  SELECT DISTINCT
    AA.COMPONENT_ALIB_ID,
    AA.COMPONENT_NAME,
    AA.COMPONENT_LIB_ID,
    AA.COMPONENT_TYPE,
    AA.CLONE_SET_ID
  FROM
    V4_ALIB_COMPONENT AA,
    V4_ASB_COMPONENT_HIERARCHY AH,
    V4_EXPT_TRIAL_ASSEMBLY EA,
    V4_EXPT_TRIAL ET,
    V4_EXPT_EXPERIMENT E
  WHERE
    E.NAME = ':exptName'
    AND E.EXPT_ID = ET.EXPT_ID
    AND ET.TRIAL_ID = EA.TRIAL_ID
    AND EA.ASSEMBLY_ID = AH.ASSEMBLY_ID
    AND (AH.COMPONENT_ALIB_ID = AA.COMPONENT_ALIB_ID OR AH.PARENT_COMPONENT_ALIB_ID = AA.COMPONENT_ALIB_ID);

REPLACE INTO tempcopy.V4_ALIB_COMPONENT
  (COMPONENT_ALIB_ID, COMPONENT_NAME, COMPONENT_LIB_ID, COMPONENT_TYPE, CLONE_SET_ID) 
  SELECT DISTINCT
    AA.COMPONENT_ALIB_ID,
    AA.COMPONENT_NAME,
    AA.COMPONENT_LIB_ID,
    AA.COMPONENT_TYPE,
    AA.CLONE_SET_ID
  FROM
    V4_ALIB_COMPONENT AA,
    V4_ASB_COMPONENT_HIERARCHY AH,
    V4_EXPT_TRIAL_CONFIG_ASSEMBLY EA,
    V4_EXPT_TRIAL ET,
    V4_EXPT_EXPERIMENT E
  WHERE
    E.NAME = ':exptName'
    AND E.EXPT_ID = ET.EXPT_ID
    AND ET.TRIAL_ID = EA.TRIAL_ID
    AND EA.ASSEMBLY_ID = AH.ASSEMBLY_ID
    AND (AH.COMPONENT_ALIB_ID = AA.COMPONENT_ALIB_ID OR AH.PARENT_COMPONENT_ALIB_ID = AA.COMPONENT_ALIB_ID);


-- V4_LIB_COMPONENT
DROP TABLE IF EXISTS tempcopy.V4_LIB_COMPONENT;

CREATE TABLE tempcopy.V4_LIB_COMPONENT AS
  SELECT DISTINCT
    AA.COMPONENT_LIB_ID,
    AA.COMPONENT_TYPE,
    AA.COMPONENT_CLASS,
    AA.INSERTION_POINT,
    AA.DESCRIPTION
  FROM
    V4_LIB_COMPONENT AA,
    tempcopy.V4_ALIB_COMPONENT AC
  WHERE
    AA.COMPONENT_LIB_ID = AC.COMPONENT_LIB_ID;

-- V4_LIB_MOD_RECIPE
DROP TABLE IF EXISTS tempcopy.V4_LIB_MOD_RECIPE;

CREATE TABLE tempcopy.V4_LIB_MOD_RECIPE AS
  SELECT DISTINCT
    CONCAT(AA.MOD_RECIPE_LIB_ID, '-cpy') AS MOD_RECIPE_LIB_ID,
    CONCAT(AA.NAME, '-cpy') AS NAME,
    AA.JAVA_CLASS,
    AA.DESCRIPTION
  FROM
    V4_LIB_MOD_RECIPE AA,
    V4_EXPT_TRIAL_MOD_RECIPE ER,
    V4_EXPT_TRIAL ET,
    V4_EXPT_EXPERIMENT E
  WHERE
    AA.MOD_RECIPE_LIB_ID = ER.MOD_RECIPE_LIB_ID
    AND ER.TRIAL_ID = ET.TRIAL_ID
    AND ET.EXPT_ID = E.EXPT_ID
    AND E.NAME = ':exptName';

-- V4_LIB_MOD_RECIPE_ARG
DROP TABLE IF EXISTS tempcopy.V4_LIB_MOD_RECIPE_ARG;

CREATE TABLE tempcopy.V4_LIB_MOD_RECIPE_ARG AS
  SELECT DISTINCT
    CONCAT(AA.MOD_RECIPE_LIB_ID, '-cpy') AS MOD_RECIPE_LIB_ID,
    AA.ARG_NAME,
    AA.ARG_ORDER,
    AA.ARG_VALUE
  FROM
    V4_LIB_MOD_RECIPE_ARG AA,
    V4_EXPT_TRIAL_MOD_RECIPE ER,
    V4_EXPT_TRIAL ET,
    V4_EXPT_EXPERIMENT E
  WHERE
    AA.MOD_RECIPE_LIB_ID = ER.MOD_RECIPE_LIB_ID
    AND ER.TRIAL_ID = ET.TRIAL_ID
    AND ET.EXPT_ID = E.EXPT_ID
    AND E.NAME = ':exptName';

