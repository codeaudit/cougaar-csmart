csmart/doc/CSMART-Troubleshooting.txt

Here are some tips for solving some common problems. In general, you
should make sure that you can run minitestconfig, and view the data
from a PSP, before worrying about CSMART specific items. If your
problem is not addressed here, send a query to
cougaar-developers@cougaar.org.

Running the AppServer
- Ensure that the Classpath for the Server, and as defined in your server
properties file, and for CSMART itself, include the same copies of
server.jar, csmart.jar, etc.
- Ensure that you edit the Server startup script to point to your
installation specific server properties file.
- Be sure that your versions of server.jar, core.jar, and csmart.jar
are all from the same build (this results in RMI exceptions
occasionally).

Showing a Society Monitor Graph
-- If you get an error about inability to find dot, or to determine
your OS, then you should make sure that dot.exe or dot-l386 are
installed in CIP/csmart/bin. Use dot.exe on Windows, dot-l386 on Solaris or
Linux (may also work on other Unix variants, not supported). If you
believe you are running one of thos OSes, and get an error message
claiming your OS was not understood, please submit a bug including the
full OS type ("uname -a" or equivalent) for your system, to the
Cougaar bug tracking site on www.cougaar.org, under the CSMART,
Society Monitor section.


Running the Society Monitor Standalone
- Ensure that the grappa, JCChart, planserver, and csmart jars are all
in the classpath for the Society Monitor
- Ensure that you have included all of the CSMART PSPs from
csmart/data/common/default.psps.xml in whichever set of PSPs you are
loading
- If you are trying to use the standard CSMART default.psps.xml, be
sure that you have set org.cougaar.config.path to include
COUGAAR_INSTALL_PATH/csmart/data/common/, and have included this
_before_ any other directory that contains a default.psps.xml. Be sure
you include "\;" between additions to the config path, and at the end
of your command-line additions.

Running one of the supplied pre-configured Societies or using the
include Metrics
- If you see an error like FileNotFoundException, Node00.ini not
found, then make sure that your org.cougaar.config.path as specified
in your AppServer properties file ends with an (escaped) semi-colon,
to ensure that the current directory is on the search path.
- If you see an error about the Mylib library when running
SingleCluster or running a society with the BasicMetric included, an
error something like:

CpuClock exception: java.lang.UnsatisfiedLinkError: no mylib in
  java.library.path

this indicates that the metrics Plugins could not find the named library,
available in scalability/bin. If on a Windows or Linux i386 machine, be sure
this libary is in a directory on your path. Otherwise, you may safely
ignore this error.
- If you see an error like: java.lang.RuntimeException: Loaded plugin
org.cougaar.tools.csmart.runtime.plugin.LocalAssetBuilder[localAssets.dat] without
CSMART Factory? Did you include the csmart domain in
configs/common/LDMDomains.ini?

This indicates that you have not loaded the csmart domain. Copy csmart/data/common/LDMDomains.ini to CIP/configs/common, or that you have edited the version of
LDMDomains that you are using to include the csmart domain:
csmart=org.cougaar.tools.csmart.runtime.ldm.CSMARTDomain
- If you get an exception like:
 java.lang.reflect.InvocationTargetException:
 java.lang.NoClassDefFoundError: javax/net/ssl/SSLServerSocket
         at
org.cougaar.core.naming.RMINameServer.contactNS(RMINameServer.java:104)
This means that the JSSE jar files could not be found. Make sure that
they are installed in your JRE installation if you have one in
addition to any JDK install.

Running a database society
- Windows don't pop up to publish Oplan, etc: Are you running an X
server? Did you do: "xhost +" or equivalent?
- If on startup you get a JDBC error like:
java.sql.SQLException: Unknown driver driver.mysql//localhost
then make sure your JDBC connection string is correctly formatted.
For mysql: jdbc:mysql://localhost/configdb
For Oracle: jdbc:oracle:thin:@myhost:1521:cougaar
- If in creating an experiment from the database, you get a message
like:
query1Int: SELECT EXPERIMENT_NUMBER.NEXTVAL FROM DUAL
java.sql.SQLException: General error: Table 'cougaar.dual' doesn't exist
        at org.gjt.mm.mysql.MysqlIO.sendCommand(MysqlIO.java:497)
then you are using MySQL to modify experiments, which is not currently
supported.
- If in configuring a host/node/agent mapping, you get an error like:
SQLException query: DROP TABLE `TMP_CMTA_CSHNA-0001`
java.sql.SQLException: General error: Access denied for user: 'soconfig_test_3i@
localhost' to database 'cougaar'

Then the permissions for your database user must be expanded to
include permission to drop tables. See your database administrator.

- If once running you the the following exception in the Node output
  stream, you are using a MySQL database without the Cougaar domain
  database installed in database "cougaar":
org.cougaar.core.node.InitializerServiceException: java.sql.SQLException: General error: Table 'cougaar.geoloc' doesn't exist
	at org.cougaar.core.node.DBInitializerServiceProvider$InitializerServiceImpl.translateAttributeValue(DBInitializerServiceProvider.java:485)

- If on start you get an error:
   Table cougaar.V4_EXPT_EXPERIMENT doesn't exist on Unix, then you
   do not have the lower_case_table_names variable set to 1.  Check
   with
   % mysqladmin variables
   If you do not have it set, edit /etc/my.cnf to include the line:
   set-variable   =   lower_case_table_names=1
   and restart your server, as per the Install instructions.
   
An alternate cause, is that you do not have a current MySQL Server
(3.23.45 or greater for Unix)

- If you get the following exception, you have an invalid cougaar.rc file or
  cougaar.rc file conflicts (Running a server on Windows and Linux).

SQLException query: SELECT A.COMPONENT_NAME COMPONENT_NAME, C.COMPONENT_CLASS 
COMPONENT_CLASS, A.COMPONENT_ALIB_ID COMPONENT_ID, C.INSERTION_POINT, 
H.INSERTION_ORDER INSERTION_ORDER FROM V4_ALIB_COMPONENT P INNER JOIN 
V4_ASB_COMPONENT_HIERARCHY H ON P.COMPONENT_ALIB_ID = H.PARENT_COMPONENT_ALIB_ID 
INNER JOIN V4_ALIB_COMPONENT A ON A.COMPONENT_ALIB_ID = H.COMPONENT_ALIB_ID 
INNER JOIN V4_LIB_COMPONENT C ON C.COMPONENT_LIB_ID = A.COMPONENT_LIB_ID WHERE 
H.ASSEMBLY_ID in () AND C.INSERTION_POINT LIKE 'Node.AgentManager.%' AND 
INSTR(SUBSTRING(C.INSERTION_POINT, LENGTH('Node.AgentManager.') + 
1), '.') = 0 AND P.COMPONENT_NAME = 'SMALL_1AD' ORDER BY INSERTION_ORDER
java.sql.SQLException: Syntax error or access violation: 
You have an error in your SQL syntax near ') AND C.INSERTION_POINT LIKE 
'Node.AgentManager.%' AND INSTR(SUBSTRING(C.INSERTI' at line 1

- If you get a Verify Error when running that contains the plugin:
  mil.darpa.log.alpine.blackjack.plugins.AntsInventoryPlugIn
  then your server props contains the line:
  org.cougaar.classpath=...SRA_IMComponentModel.jar
  comment this out if you are NOT running with SRA
  
  If you get a Verify Error when running that contains the plugin:
  com.sra.ul.bpdt.exec.inventory.BPDTInventoryPlugIn
  then your server props does not contain the line:
  org.cougaar.classpath=...SRA_IMComponentModel.jar
  

  
Running CSMART
- Ensure that csmart, planserver, server, grappa, jcchart, xerces,
glm, and core jar files are all included
- Ensure that all jar files are from the same build


Configuring a Scalability Society
- Be sure you have at least one Leaf Allocator in your last level.
- There is always one agent in the first level.
- There should be at least one Org Allocator in each of the middle levels.


Configuring an ABC Society
- You must have at least one community, and at least as many levels as
communities


Configuring an External ABC Impact
- To include an impact in an experiment, remember to drag it into the
Experiment in the Experiment Builder.
- For Cyber Attacks, the _full_ agent name must be specified, as it is
generated by the CSMART Configuration Builder. Otherwise, your impacts
will not be transduced into InfrastructureEvents.
- Kinetic Events will only work once Organizations and Entities
support having geographic locations.

Starting a Society from the Experiment Controller
- Ensure you've followed all the tips on running the Server above
- Be sure that the name of the host you've asked a Node to be started
on is either an IP address or the fully-qualified host name
- Be sure that you can resolve the host name into an IP address
- If running Nodes on more than one machine, try running
minitestconfig split among those machines, and ensure that that works
- If running a database society, be sure that you can connect to the
database using the appropriate username and password from a command
line tool.
- If a running Node in an Experiment contains the exception:
Xlib: connection to "servername" refused by server
Xlib: client is not authorized to connect to server

Java.lang.InternalError: can't connect to X11 window server using "xxx" as the 
display value.

You forgot to run 'xhost +' in the X Server on the machine running CSMART.

Viewing Metrics Results
- The Scalability society may not write any metrics until it has
completed running.
- Set the Sample Interval to non-zero (but small) to force the
scalability society to take some intermediate samples
- Be sure that on Windows you edited the command-line parameter
specifying the location of Excel

Linux Specific Issues
- Various display issues have been noticed on Linux Systems with JDK1_3.
Some of these include:
  * Windows opening very small
  * Menus displaying incorrectly
  * Drag and Drop acting funny
Installing the Linux Blackdown JVM seems to have addressed all of the above
issues. http://www.blackdown.org
- See Linux Issues above in Database section

Compiling CSMART
- Compiling CSMART with Jikes 1.15 will result in VerifyErrors in a few classes.  To
  avoid these erros, use Jikes 1.14.


MySQL Database issues
- If you get SQL errors, claiming that a table does not exist, eg
error: Table 'mycoug.V4_EXPT_EXPERIMENT' doesn't exist
(but which you believe does in fact exist), it may be a case issue - MySQL
is case sensitive on table names. This solution applies to MySQL
databases run on Unix.
The correct version of the tables in the database are ALL LOWERCASE.
To get all queries automatically converted to lowercase, you should
set the following MySQL server parameter:
lower_case_table_names.

On Windows, this variable is defaulted to 1, on Unix, it is defaulted to 0.
When set to 1, all table names are set to lower case on load and store.
To solve the Unix case problem, create a file /etc/my.cnf and add:
[mysqld]
set-variable   =   lower_case_table_names=1

Then restart your server.
Note that if you have already loaded data into your Unix MySQL
database, the table names may be uppercase in some instances. This
will cause problems - you will need to reload your database, after
setting the above parameter.

Recipe Queries not available:
- You have written your own recipe queries, but they are not available
when building your recipe?
  Did you name the recipe "recipeQuery<Something>"? All recipe queries
  must start with "recipeQuery", case sensitive.

  Did you put the recipe query in CIP/configs/common/PopulateDb.q? If
  so, have you since updated you Cougaar installation (over-writing
  any queries you included there?)

  Otherwise, did you put the recipe query in a file called
  recipeQueries.q? Is that file someplace on the ConfigPath (ie
  CIP/configs/common or the directory from which you launched CSMART)?
  It must be to be found.

  If you put the query in any other file, it will not be found.

      
Be sure to check the Cougaar Bug list for known issues, at http://www.cougaar.org/bugs 
If all else fails, send a query to cougaar-developers@cougaar.org
